import *as THREE from "./libs/three/three.module.js"; import { GLTFLoader } from "./libs/three/jsm/GLTFLoader.js"; class App { constructor() { this.previousid = -1, this.clock = new THREE.Clock, this.previousTime = 0, this.last_stabbed_time = 0, this.last_ghost_time = 0, this.die_time = 0, this.score_time = -1, this.timestamp = 0, this.receive_timestamp = 0, this.high_ping_time = -1, this.all_player_data = [], this.receive_player_data = [], this.objectsToUpdate = [], this.plane_data = [], this.receive_plane_key = -1, this.plane_key = -1, this.previous_plane_key = -1, this.increase_planekeyTime = 0, this.receive_plane_key_time = 0, this.ready_sw = 0, this.right_sw = 0, this.left_sw = 0, this.jump_sw = 0, this.emoji_button_sw = 0, this.emoji_sw = -1, this.emoji = -1, this.emoji_time = 0, this.die_sw = 0, this.fox_finalpositionx = 0, this.fox_finalpositiony = 0, this.mixer = [], this.fox_push_power = 0, this.fox_push_power2 = 0, this.fox_score = 0, this.fox_life = 10, this.fox_previousPlane = null, this.fox_animation = 0, this.fox_plane_id = null, this.fox_plane_type = 0, this.fox_action = -1, this.spring_sound_play = 0, this.mobile = 0, this.gltfloader = (new GLTFLoader).setPath("./assets/model/"), this.stabbed_audio = document.getElementById("stabbedMusic"), this.plane_audio = document.getElementById("planeMusic"), this.convey_audio = document.getElementById("conveyMusic"), this.fake_audio = document.getElementById("fakeMusic"), this.spring_audio = document.getElementById("springMusic"), this.die_audio = document.getElementById("dieMusic"), this.devil_audio = document.getElementById("devilMusic"), this.bite_audio = document.getElementById("biteMusic"), this.chest_audio = document.getElementById("chestMusic"), this.sack_audio = document.getElementById("sackMusic"), /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) && (this.mobile = 1, document.querySelector(".leader-board-wrapper").style.fontSize = "7px", document.querySelector(".leader-board-wrapper").style.top = "20px", document.querySelector(".leader-board-wrapper").style.width = "135px", document.querySelector(".leader-board-wrapper").style.height = "140px"); const t = document.createElement("div"); document.body.appendChild(t), this.camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, .1, 100), this.camera.position.set(0, 4, 45), this.scene = new THREE.Scene; const e = new THREE.HemisphereLight(16777215, 12303359, .8); this.scene.add(e); const i = new THREE.DirectionalLight(16777215, .5); i.position.set(.2, 1, 1), this.scene.add(i), this.renderer = new THREE.WebGLRenderer({ antialias: !0, alpha: !0 }), this.renderer.setPixelRatio(window.devicePixelRatio), this.renderer.setSize(window.innerWidth, window.innerHeight), t.appendChild(this.renderer.domElement), this.leaderboard = document.querySelector(".leader-board-wrapper"), this.own_score = document.querySelector(".own_score"), this.gg_board = document.querySelector(".gg_board"), this.restart = document.querySelector(".restart"), this.send_name = document.querySelector(".send_name"), this.modal = document.querySelector(".modal"), this.box = document.querySelector(".box"), this.initial_fox(), window.addEventListener("resize", this.resize.bind(this)), document.querySelector(".Name").addEventListener("keydown", function (t) { 13 === t.keyCode && t.preventDefault() }), this.restart.addEventListener("click", () => { window.location.reload() }), this.send_name.addEventListener("click", () => { if (1 === this.ready_sw && this.ready_for_load_model && this.clock.getElapsedTime() > 5) { this.ready_sw = 0, this.setListerner(), this.load_LifeBar(), this.modal.classList.add("hidden"), this.box.classList.remove("fadeOut"), this.box.classList.add("bounceOut"), this.leaderboard.classList.remove("hidden"), this.fox = this.model.clone(), this.fox.children[0].children[1].material = this.model.children[0].children[1].material.clone(), this.fox.children[1].children[0].children[1].material = this.model.children[1].children[0].children[1].material.clone(), this.fox.children[1].children[1].children[1].material = this.model.children[1].children[1].children[1].material.clone(), this.fox.children[2].children[0].children[1].material = this.model.children[2].children[0].children[1].material.clone(), this.fox.children[2].children[1].children[1].material = this.model.children[2].children[1].children[1].material.clone(), this.fox.position.x = this.fox_positionx, this.fox.position.y = 20, this.fox.children[0].children[1].material.color = new THREE.Color(this.fox_r, this.fox_g, this.fox_b), this.fox.children[1].children[0].children[1].material.color = new THREE.Color(this.fox_r, this.fox_g, this.fox_b), this.fox.children[1].children[1].children[1].material.color = new THREE.Color(this.fox_r, this.fox_g, this.fox_b), this.fox.children[2].children[0].children[1].material.color = new THREE.Color(this.fox_r, this.fox_g, this.fox_b), this.fox.children[2].children[1].children[1].material.color = new THREE.Color(this.fox_r, this.fox_g, this.fox_b), this.scene.add(this.fox); let t = { title: "3", positionx: this.fox_positionx, positiony: 20, r: this.fox_r, g: this.fox_g, b: this.fox_b, name: document.querySelector(".Name").value }; this.socket.send(JSON.stringify(t)), this.fox_name = document.createElement("div"), this.fox_name.style.position = "absolute", this.fox_name.style.width = 100, this.fox_name.style.height = 100, this.fox_name.style.opacity = .5, this.fox_name.style.color = "white", this.fox_name.innerHTML = document.querySelector(".Name").value, this.fox_name.style.top = window.innerHeight / 2 + "px", this.fox_name.style.left = window.innerWidth / 2 + "px", document.body.appendChild(this.fox_name), this.fox_status = document.createElement("div"), this.fox_status.style.position = "absolute", this.fox_status.style.width = 100, this.fox_status.style.height = 100, this.fox_status.style.opacity = .5, this.fox_status.style.color = "white", this.fox_status.innerHTML = "", this.fox_status.style.top = window.innerHeight / 2 + "px", this.fox_status.style.left = window.innerWidth / 2 + "px", document.body.appendChild(this.fox_status), this.scene.remove(this.model) } }), this.worker = new Worker("Worker.js", { type: "module" }), this.render(); const o = new THREE.TextureLoader, s = o.load("./assets/12.jpeg"), a = o.load("./assets/13.jpeg"), n = o.load("./assets/matcap/1.png"), l = o.load("./assets/matcap/4.png"), h = o.load("./assets/matcap/4.png"), r = o.load("./assets/matcap/8.png"); this.green_texture2 = o.load("./assets/matcap/11.png"), this.planegeometry = new THREE.BoxGeometry(12, 2, 1), this.planematerial0 = new THREE.MeshStandardMaterial({ map: s }), this.planematerial1 = new THREE.MeshStandardMaterial({ map: s, color: 16711680 }), this.planematerial2 = new THREE.MeshStandardMaterial({ map: a }), this.planematerial3 = new THREE.MeshMatcapMaterial({ matcap: l }), this.planematerial4 = new THREE.MeshStandardMaterial({ color: 16777215 }), this.test_plane_size = null; let d = new THREE.PlaneGeometry(2700, 80), p = new THREE.MeshMatcapMaterial({ color: 1118600 }); p.matcap = n; const _ = new THREE.Mesh(d, p); _.position.z -= 10, this.scene.add(_), d = new THREE.ConeGeometry(1.5, 3, 64); let c = new THREE.MeshMatcapMaterial; c.matcap = l; for (let t = -1400; t < 1400; t += 3) { const e = new THREE.Mesh(d, c); e.rotation.x = Math.PI, e.position.y = 27.5, e.position.x = t, this.scene.add(e) } d = new THREE.BoxGeometry(2700, 1, 3); const y = new THREE.Mesh(d, c); y.position.y = 29, this.scene.add(y), this.sting_plane = new THREE.Group; const m = new THREE.BoxBufferGeometry(11, .5, 1), x = new THREE.Mesh(m, c); x.position.y += .1, this.sting_plane.add(x); const f = new THREE.Mesh(m, c); f.position.y += .73, this.sting_plane.add(f); const u = new THREE.ConeGeometry(.7, 2, 64); for (let t = -4.8; t < 5.6; t += 1.6) { const e = new THREE.Mesh(u, c); e.scale.z = .5, e.position.set(t, 1.8, 0), this.sting_plane.add(e) } this.convey = new THREE.Group; const b = new THREE.BoxBufferGeometry(11, 1.5, 1), w = new THREE.SphereGeometry(1.1, 32, 32), T = new THREE.CylinderGeometry(.1, .1, 2, 32), g = new THREE.CylinderGeometry(1.1, 1.1, 1, 32), j = new THREE.BoxBufferGeometry(.9, .3, 1); let E = new THREE.MeshMatcapMaterial; E.matcap = h; const M = new THREE.MeshBasicMaterial({ color: 3355443 }), v = new THREE.Mesh(b, new THREE.MeshStandardMaterial({ color: 6710886 })), H = new THREE.Group, L = new THREE.Mesh(w, E), z = new THREE.Mesh(g, E), U = new THREE.Mesh(T, M); for (let t = 0; t < 5; t++) { let e = U.clone(); e.position.set(.5 * Math.cos(t / Math.PI * 4), .5 * Math.sin(t / Math.PI * 4), -.3), e.rotation.x = Math.PI / 2, H.add(e) } H.add(L), H.add(z), z.rotation.x = Math.PI / 2, L.scale.z = .5, L.position.z = .2; const R = H.clone(); H.position.x = 5, R.position.x = -5; const k = new THREE.Group, S = new THREE.CylinderGeometry(.05, .5, 1, 32), P = new THREE.Mesh(S, new THREE.MeshStandardMaterial({ color: 15658581 })); P.rotation.z = Math.PI / 2, P.scale.z = .1, P.position.z = .5; const C = P.clone(); P.position.x -= .6, C.position.x += .6, k.add(P), k.add(C); const q = new THREE.Mesh(j, E), I = function (t, e) { return Math.round(Math.round(t * Math.pow(10, (e || 0) + 1)) / 10) / Math.pow(10, e || 0) }; for (let t = -5; t <= 5; t += 1) { let e, i; e = q.clone(), i = q.clone(), e.position.set(I(t, 2), .9, 0), i.position.set(I(t, 2), -.9, 0), this.convey.add(e), this.convey.add(i) } this.convey.add(k), this.convey.add(H), this.convey.add(R), this.convey.add(v), this.trampoline = new THREE.Group, this.trampoline_plane_geometry = new THREE.BoxBufferGeometry(12, .4, 1), this.green_material = new THREE.MeshMatcapMaterial({ color: 11206570 }), this.green_material.matcap = r; const G = new THREE.Mesh(this.trampoline_plane_geometry, this.green_material), A = new THREE.Mesh(this.trampoline_plane_geometry, this.green_material), B = new THREE.TorusGeometry(1, .08, 10, 10), W = new THREE.Mesh(B, c); W.rotation.x = Math.PI / 2, W.rotation.y = -.15, W.scale.y = .3; for (let t = -4.5; t < 6; t += 3)for (let e = -.6; e < .8; e += .2) { let i = W.clone(); i.position.set(t, e, 0), this.trampoline.add(i) } G.position.set(0, .8, 0), A.position.set(0, -.8, 0), this.trampoline.add(G), this.trampoline.add(A); let N = new THREE.PlaneGeometry(100, 80), F = new THREE.MeshStandardMaterial({ color: 16711680 }); this.stabbed_plane = new THREE.Mesh(N, F), this.stabbed_plane.position.z = 10, this.stabbed_plane.visible = !1, this.scene.add(this.stabbed_plane), this.loadobject(), this.calculate_screenWidth() } calculate_screenWidth() { const t = THREE.MathUtils.degToRad(this.camera.fov), e = 2 * Math.tan(t / 2) * 40 * this.camera.aspect; this.screenWidth = e } toXYCoords(t) { const e = t.position.clone(); e.x -= 2, e.y += 6, e.project(this.camera); const i = e.x * window.innerWidth * .5, o = -e.y * window.innerHeight * .5, s = new THREE.Vector2; return s.x = i, s.y = o, s } load_LifeBar() { this.add_life_material = new THREE.MeshMatcapMaterial({ color: 11206570, transparent: !0, opacity: .8 }), this.add_life_material.matcap = this.green_texture2, this.subtract_life_material = new THREE.MeshStandardMaterial({ color: 6710886, transparent: !0, opacity: .8 }); const t = new THREE.CylinderGeometry(.54, .54, 2.5, 10); this.life_bar = new THREE.Group; const e = new THREE.Mesh(t, new THREE.MeshStandardMaterial), i = (new GLTFLoader).setPath("./assets/model/"), o = this; i.load("life_bar.glb", function (t) { t.scene.scale.set(1.5, 1.5, 1.5), t.scene.position.x += 5, t.scene.position.y -= 3, o.life_bar.add(t.scene) }, function (t) { }, function (t) { console.log("An error happened"), console.log(t) }), e.scale.z = .3; for (let t = 2.3; t <= 12.5; t += 1.1) { const i = e.clone(); i.material = this.add_life_material, i.position.x = t, i.position.z -= 1, this.life_bar.add(i) } this.life_bar.scale.set(.9, .9, .3), this.scene.add(this.life_bar) } setsocketListener() { this.socket = new WebSocket("wss://nssocketio-sleepy-porcupine-oa.mybluemix.net/"), this.socket.onmessage = (t => { let e = JSON.parse(t.data); if ("1" === e.title) this.myID = e.id, this.ready_sw = 1; else if ("2" === e.title) { for (let t = 0; t < e.data.length; t += 7)e.data[t] !== this.myID && this.loadPlayer(e.data[t], e.data[t + 1], e.data[t + 2], e.data[t + 3], e.data[t + 4], e.data[t + 5], e.data[t + 6]); this.ready_for_load_model = 1 } else if ("4" === e.title) e.data[0] !== this.myID && this.loadPlayer(e.data[0], e.data[1], e.data[2], e.data[3], e.data[4], e.data[5], e.data[6]); else if ("5" === e.title) { for (let t = 0; t < this.all_player_data.length; t++)if (this.all_player_data[t].id === e.id) { this.scene.remove(this.all_player_data[t].mesh), this.all_player_data[t].name_mesh.remove(), this.all_player_data.splice(t, 1); break } } else if ("6" === e.title) { this.receive_player_data = e.data; for (let t = 0; t < e.data.length; t += 10)if (e.data[t] !== this.myID) for (let i = 0; i < this.all_player_data.length; i++)e.data[t] === this.all_player_data[i].id && this.all_player_data[i].timestamp !== e.data[t + 7] && (this.all_player_data[i].final_positionx = e.data[t + 1], this.all_player_data[i].final_positiony = e.data[t + 2], this.all_player_data[i].plane_id = e.data[t + 3], this.all_player_data[i].animation = e.data[t + 4], this.all_player_data[i].emoji = e.data[t + 6], this.all_player_data[i].timestamp = e.data[t + 7], this.all_player_data[i].die_sw = e.data[t + 8], this.all_player_data[i].rank = e.data[t + 9]); else if (e.data[t] === this.myID && this.receive_timestamp !== e.data[t + 7]) { let i = this.receive_timestamp; i > e.data[t + 7] && (i -= 1e4), e.data[t + 7] - i < 10 && this.clock.getElapsedTime() - this.high_ping_time > 2 ? (document.querySelector(".ping").style.color = "white", document.querySelector(".ping").innerHTML = "Ping: " + 10 * (e.data[t + 7] - i), document.querySelector(".ping").innerHTML += '<font size="1vmin">ms</font>', this.high_ping_time = -1) : e.data[t + 7] - i <= 11 && e.data[t + 7] - i >= 10 ? (this.high_ping_time = this.clock.getElapsedTime(), document.querySelector(".ping").style.color = "white", document.querySelector(".ping").innerHTML = "Ping: " + 10 * (e.data[t + 7] - i), document.querySelector(".ping").innerHTML += '<font size="1vmin">ms</font>') : e.data[t + 7] - i > 11 && e.data[t + 7] - i <= 13 ? (this.high_ping_time = this.clock.getElapsedTime(), document.querySelector(".ping").style.color = "orange", document.querySelector(".ping").innerHTML = "Ping: " + 10 * (e.data[t + 7] - i), document.querySelector(".ping").innerHTML += '<font size="1vmin">ms</font>') : e.data[t + 7] - i > 13 && (this.high_ping_time = this.clock.getElapsedTime(), document.querySelector(".ping").style.color = "red", document.querySelector(".ping").innerHTML = "Ping: " + 10 * (e.data[t + 7] - i), document.querySelector(".ping").innerHTML += '<font size="1vmin">ms</font>', document.querySelector(".ping").innerHTML += " ⚠️"), this.fox_finalpositionx = e.data[t + 1], this.fox_finalpositiony = e.data[t + 2], this.receive_timestamp = e.data[t + 7] } } else if ("8" === e.title) { document.querySelector(".goat-player-name").innerHTML = e.data[1], document.querySelector(".goat-player-score").innerHTML = e.data[2]; for (let t = 3; t < e.data.length; t += 3)t <= 30 && (document.querySelector(`.leaderboard-player${t / 3}`).innerHTML = "#" + t / 3 + " " + e.data[t + 1], document.querySelector(`.score${t / 3}`).innerHTML = e.data[t + 2]), e.data[t] === this.myID && (document.querySelector(".own_rank").innerHTML = t / 3 + " of " + (e.data.length - 3) / 3, this.fox_rank = t / 3); if (e.data.length < 33) for (let t = e.data.length; t < 33; t += 3)document.querySelector(`.leaderboard-player${t / 3}`).innerHTML = "#" + t / 3, document.querySelector(`.score${t / 3}`).innerHTML = 0 } else "7" === e.title && this.plane_key !== e.plane_key && (this.receive_plane_key = e.plane_key) }) } setListerner() { 1 === this.mobile && (document.querySelector(".mobile-left-button").classList.remove("hidden"), document.querySelector(".mobile-right-button").classList.remove("hidden"), document.querySelector(".mobile-q-button").classList.remove("hidden"), document.querySelector(".mobile-w-button").classList.remove("hidden"), document.querySelector(".mobile-e-button").classList.remove("hidden"), document.getElementsByClassName("mobile-left-button")[0].addEventListener("touchstart", () => { this.left_sw = 1 }), document.getElementsByClassName("mobile-right-button")[0].addEventListener("touchstart", () => { this.right_sw = 1 }), document.getElementsByClassName("mobile-q-button")[0].addEventListener("touchstart", () => { this.emoji_sw = 1, this.emoji_button_sw = 1 }), document.getElementsByClassName("mobile-w-button")[0].addEventListener("touchstart", () => { this.emoji_sw = 2, this.emoji_button_sw = 1 }), document.getElementsByClassName("mobile-e-button")[0].addEventListener("touchstart", () => { this.emoji_sw = 3, this.emoji_button_sw = 1 }), document.getElementsByClassName("mobile-left-button")[0].addEventListener("touchend", () => { this.left_sw = 0 }), document.getElementsByClassName("mobile-right-button")[0].addEventListener("touchend", () => { this.right_sw = 0 }), document.getElementsByClassName("mobile-q-button")[0].addEventListener("touchend", () => { this.emoji_sw = -1, this.emoji_button_sw = 0 }), document.getElementsByClassName("mobile-w-button")[0].addEventListener("touchend", () => { this.emoji_sw = -1, this.emoji_button_sw = 0 }), document.getElementsByClassName("mobile-e-button")[0].addEventListener("touchend", () => { this.emoji_sw = -1, this.emoji_button_sw = 0 })), window.addEventListener("keydown", t => { 68 !== t.keyCode && "ArrowRight" !== t.key || (this.right_sw = 1), 65 !== t.keyCode && "ArrowLeft" !== t.key || (this.left_sw = 1), 81 === t.keyCode && (this.emoji_sw = 1, this.emoji_button_sw = 1), 87 === t.keyCode && (this.emoji_sw = 2, this.emoji_button_sw = 1), 69 === t.keyCode && (this.emoji_sw = 3, this.emoji_button_sw = 1) }), window.addEventListener("keyup", t => { 68 !== t.keyCode && "ArrowRight" !== t.key || (this.right_sw = 0), 65 !== t.keyCode && "ArrowLeft" !== t.key || (this.left_sw = 0), 81 === t.keyCode && (this.emoji_sw = -1, this.emoji_button_sw = 0), 87 === t.keyCode && (this.emoji_sw = -1, this.emoji_button_sw = 0), 69 === t.keyCode && (this.emoji_sw = -1, this.emoji_button_sw = 0) }) } resize() { this.camera.aspect = window.innerWidth / window.innerHeight, this.camera.updateProjectionMatrix(), this.renderer.setSize(window.innerWidth, window.innerHeight), this.calculate_screenWidth() } initial_fox() { this.fox_positionx = Math.floor(2e3 * Math.random() - 1e3), this.fox_r = Math.ceil(100 * Math.random()) / 100, this.fox_g = Math.ceil(100 * Math.random()) / 100, this.fox_b = Math.ceil(100 * Math.random()) / 100, this.createModel() } createModel() { const t = (new GLTFLoader).setPath("./assets/model/"), e = this; t.load("body_ns.glb", function (t) { e.model = new THREE.Group; const i = t.scene; i.scale.set(20, 20, 20), i.position.y = -1, e.model.add(i), e.loadRhand() }, function (t) { }, function (t) { console.log("An error happened"), console.log(t) }) } loadRhand() { const t = (new GLTFLoader).setPath("./assets/model/"), e = this; t.load("Rhand.glb", function (t) { e.Rhand = new THREE.Group; const i = t.scene; i.scale.set(15, 15, 15), i.position.z = -7, e.Rhand.add(i), e.model.add(e.Rhand), e.loadRfist() }, function (t) { }, function (t) { console.log("An error happened"), console.log(t) }) } loadRfist() { const t = (new GLTFLoader).setPath("./assets/model/"), e = this; t.load("Rfist.glb", function (t) { const i = t.scene; i.scale.set(15, 15, 15), i.position.z = -7, e.Rhand.add(i), e.Rhand.position.y = -5, e.model.add(e.Rhand), e.loadLhand() }, function (t) { }, function (t) { console.log("An error happened"), console.log(t) }) } loadLhand() { const t = (new GLTFLoader).setPath("./assets/model/"), e = this; t.load("Lhand.glb", function (t) { e.Lhand = new THREE.Group; const i = t.scene; i.scale.set(15, 15, 15), i.position.z = 7, e.Lhand.add(i), e.model.add(e.Lhand), e.loadLfist() }, function (t) { }, function (t) { console.log("An error happened"), console.log(t) }) } loadLfist() { const t = (new GLTFLoader).setPath("./assets/model/"), e = this; t.load("Lfist.glb", function (t) { const i = t.scene; i.scale.set(15, 15, 15), i.position.z = 7, e.Lhand.add(i), e.Lhand.position.y = -5, e.model.add(e.Lhand), e.loadhead() }, function (t) { }, function (t) { console.log("An error happened"), console.log(t) }) } loadhead() { const t = (new GLTFLoader).setPath("./assets/model/"), e = this; t.load("head_ns.glb", function (t) { const i = t.scene; i.scale.set(20, 20, 20), i.position.y = .2, i.position.x = 2, e.model.add(i), e.loadleg() }, function (t) { }, function (t) { console.log("An error happened"), console.log(t) }) } loadleg() { const t = (new GLTFLoader).setPath("./assets/model/"), e = this; t.load("foot_ns.glb", function (t) { const i = t.scene; i.scale.set(18, 18, 18), i.position.x = 0, i.position.z = 4, i.position.y = 1, i.castShadow = !0, e.model.add(i); const o = i.clone(); o.position.z = -i.position.z, e.model.add(o), e.model.scale.set(.1, .1, .1), e.model.position.y = 20, e.loadAngry_symbol() }, function (t) { }, function (t) { console.log("An error happened"), console.log(t) }) } loadAngry_symbol() { const t = (new GLTFLoader).setPath("./assets/model/"), e = this; t.load("angry_speech.glb", function (t) { const i = t.scene; i.scale.set(600, 600, 600), i.position.x = 10, i.position.y = 35, i.position.z = -15, e.model.add(i), e.loadThumbup_symbol() }, function (t) { }, function (t) { console.log("An error happened"), console.log(t) }) } loadThumbup_symbol() { const t = (new GLTFLoader).setPath("./assets/model/"), e = this; t.load("thumbup_speech.glb", function (t) { const i = t.scene; i.scale.set(600, 600, 600), i.position.x = 10, i.position.y = 35, i.position.z = -15, e.model.add(i), e.loadheart_symbol() }, function (t) { }, function (t) { console.log("An error happened"), console.log(t) }) } loadheart_symbol() { const t = (new GLTFLoader).setPath("./assets/model/"), e = this; t.load("heart_speech.glb", function (t) { const i = t.scene; i.scale.set(600, 600, 600), i.position.x = 10, i.position.y = 35, i.position.z = -15, e.model.add(i), e.scene.add(e.model), e.model.position.y = -26, e.setsocketListener() }, function (t) { }, function (t) { console.log("An error happened"), console.log(t) }) } loadobject() { const t = (new GLTFLoader).setPath("./assets/model/"), e = this; t.load("ghost.glb", function (t) { e.ghost = t.scene, e.ghost.scale.set(1.5, 1.2, 1.2) }, function (t) { }, function (t) { console.log("An error happened"), console.log(t) }), t.load("ham.glb", function (t) { e.ham = t.scene, e.ham.scale.set(.9, .9, .9) }, function (t) { }, function (t) { console.log("An error happened"), console.log(t) }), t.load("moneysack.glb", function (t) { e.moneysack = t.scene, e.moneysack.scale.set(1.5, 1.5, 1.5) }, function (t) { }, function (t) { console.log("An error happened"), console.log(t) }), t.load("chest.glb", function (t) { e.chest = t.scene, e.chest.scale.set(1.2, 1.2, .5) }, function (t) { }, function (t) { console.log("An error happened"), console.log(t) }) } loadPlayer(t, e, i, o, s, a, n) { const l = this.model.clone(); l.position.x = e, l.position.y = i; const h = document.createElement("div"); h.style.position = "absolute", h.style.width = 100, h.style.height = 100, h.style.opacity = .5, h.style.color = "white", h.innerHTML = n, h.style.top = window.innerHeight / 2 + "px", h.style.left = window.innerWidth / 2 + "px", document.body.appendChild(h), l.children[0].children[1].material = this.model.children[0].children[1].material.clone(), l.children[1].children[0].children[1].material = this.model.children[1].children[0].children[1].material.clone(), l.children[1].children[1].children[1].material = this.model.children[1].children[1].children[1].material.clone(), l.children[2].children[0].children[1].material = this.model.children[2].children[0].children[1].material.clone(), l.children[2].children[1].children[1].material = this.model.children[2].children[1].children[1].material.clone(), l.children[0].children[1].material.color = new THREE.Color(o, s, a), l.children[1].children[0].children[1].material.color = new THREE.Color(o, s, a), l.children[1].children[1].children[1].material.color = new THREE.Color(o, s, a), l.children[2].children[0].children[1].material.color = new THREE.Color(o, s, a), l.children[2].children[1].children[1].material.color = new THREE.Color(o, s, a); const r = []; r.push(e), r.push(e); const d = []; d.push(i), d.push(i), this.all_player_data.push({ mesh: l, id: t, onplane: null, plane_type: 0, onplane_time: 0, last_moving_time: 0, name_mesh: h, animation: 3, final_positionx: r, final_positiony: d, name: n, die_sw: 0 }), this.scene.add(l) } Animate_Character(t, e, i, o) { 1 === o ? (t.children[6].visible = !0, t.children[7].visible = !1, t.children[8].visible = !1) : 2 === o ? (t.children[6].visible = !1, t.children[7].visible = !0, t.children[8].visible = !1) : 3 === o ? (t.children[6].visible = !1, t.children[7].visible = !1, t.children[8].visible = !0) : (t.children[6].visible = !1, t.children[7].visible = !1, t.children[8].visible = !1); const s = Math.PI; let a = i; a *= 20, a %= 2 * s, 1 === e || 2 === e ? (t.children[4].position.x = 5 * Math.cos(a), t.children[4].position.y = Math.max(t.children[0].position.y - 6, t.children[4].position.y), t.children[5].position.x = 5 * Math.cos(a + s), t.children[5].position.y = Math.max(t.children[0].position.y - 6, t.children[5].position.y), t.children[0].position.y = -1 - 5 * Math.cos(2 * a) * .2, t.children[0].rotation.y = 5 * -Math.cos(a + s) * .05, t.children[1].children[0].visible = !1, t.children[1].children[1].visible = !0, t.children[1].position.x = 5 * Math.cos(a), t.children[1].rotation.x = 0, t.children[1].position.y = t.children[0].position.y - 4, t.children[1].position.z = t.children[0].position.z - 1, t.children[2].children[0].visible = !1, t.children[2].children[1].visible = !0, t.children[2].position.x = 5 * Math.cos(a + s), t.children[2].rotation.x = 0, t.children[2].position.y = t.children[0].position.y - 4, t.children[2].position.z = t.children[0].position.z + 1, t.children[3].position.y = 1 - 5 * Math.cos(2 * a) * .3, t.children[3].rotation.x = 5 * Math.cos(a) * .02, t.children[3].rotation.z = 0, t.children[3].position.x = t.children[0].position.x + 3, a > s ? (t.children[4].rotation.z = Math.cos(2 * a + s / 4) * s / 8, t.children[5].rotation.z = 0) : (t.children[4].rotation.z = 0, t.children[5].rotation.z = Math.cos(2 * a + s / 4) * s / 8), 1 === e ? (t.rotation.y = Math.PI + .2, t.children[6].rotation.y = Math.PI / 2 - .2, t.children[6].position.z = t.children[0].position.z - 12, t.children[6].position.x = t.children[0].position.x - 10, t.children[6].position.y = t.children[0].position.y + 40, t.children[7].rotation.y = Math.PI / 2 - .2, t.children[7].position.z = t.children[0].position.z - 12, t.children[7].position.x = t.children[0].position.x - 10, t.children[7].position.y = t.children[0].position.y + 40, t.children[8].rotation.y = Math.PI / 2 - .2, t.children[8].position.z = t.children[0].position.z - 12, t.children[8].position.x = t.children[0].position.x - 10, t.children[8].position.y = t.children[0].position.y + 40) : 2 === e && (t.rotation.y = -.2, t.children[6].rotation.y = -Math.PI / 2 + .2, t.children[6].position.z = t.children[0].position.z + 12, t.children[6].position.x = t.children[0].position.x + 15, t.children[6].position.y = t.children[0].position.y + 40, t.children[7].rotation.y = -Math.PI / 2 + .2, t.children[7].position.z = t.children[0].position.z + 12, t.children[7].position.x = t.children[0].position.x + 15, t.children[7].position.y = t.children[0].position.y + 40, t.children[8].rotation.y = -Math.PI / 2 + .2, t.children[8].position.z = t.children[0].position.z + 12, t.children[8].position.x = t.children[0].position.x + 15, t.children[8].position.y = t.children[0].position.y + 40)) : (t.children[6].rotation.y = 0, t.children[6].position.x = t.children[0].position.x + 10, t.children[6].position.z = t.children[0].position.z - 12, t.children[6].position.y = t.children[0].position.y + 40, t.children[7].rotation.y = 0, t.children[7].position.x = t.children[0].position.x + 10, t.children[7].position.z = t.children[0].position.z - 12, t.children[7].position.y = t.children[0].position.y + 40, t.children[8].rotation.y = 0, t.children[8].position.x = t.children[0].position.x + 10, t.children[8].position.z = t.children[0].position.z - 12, t.children[8].position.y = t.children[0].position.y + 40, 0 == e && (t.children[1].rotation.x = 0), t.children[1].children[0].visible = !1, t.children[1].children[1].visible = !0, t.children[1].rotation.z = 0, t.children[1].position.y = t.children[0].position.y - 2.5, t.children[1].position.x = t.children[0].position.x + .5, t.children[1].position.z = t.children[0].position.z - 2, 0 == e && (t.children[2].rotation.x = 0), t.children[2].children[0].visible = !1, t.children[2].children[1].visible = !0, t.children[2].rotation.z = 0, t.children[2].position.y = t.children[0].position.y - 2.5, t.children[2].position.x = t.children[0].position.x + .5, t.children[2].position.z = t.children[0].position.z + 2, t.children[3].rotation.z = Math.cos(i) / 10, t.children[3].rotation.x = 0, t.children[3].position.y = t.children[0].position.y + 1.2, t.children[3].position.x = t.children[0].position.x + 4, t.children[4].rotation.z = 0, t.children[4].position.y = t.children[0].position.y + 2, t.children[4].position.x = t.children[0].position.x, t.children[4].position.z = t.children[0].position.z - 4, t.children[5].rotation.z = 0, t.children[5].position.y = t.children[0].position.y + 2, t.children[5].position.x = t.children[0].position.x, t.children[5].position.z = t.children[0].position.z + 4, t.rotation.y = -Math.PI / 2, 3 === e && (t.children[1].children[0].visible = !0, t.children[1].children[1].visible = !1, t.children[2].children[0].visible = !0, t.children[2].children[1].visible = !1, Math.floor(100 * t.children[1].rotation.x) % 13 == 0 ? t.children[1].rotation.x += .13 : t.children[1].rotation.x -= .1, t.children[1].rotation.x < 0 && (t.children[1].rotation.x = .13), t.children[1].rotation.x > 1 && (t.children[1].rotation.x = .9), t.children[1].position.z = -2 + t.children[0].position.z - (21 - 21 * (1 - t.children[1].rotation.x)), t.children[1].position.y = t.children[0].position.y + 6 - 12 * (1 - t.children[1].rotation.x), t.children[1].position.x = t.children[0].position.x - 1, Math.floor(100 * t.children[2].rotation.x) % 13 == 0 ? t.children[2].rotation.x -= .13 : t.children[2].rotation.x += .1, t.children[2].rotation.x < -1 && (t.children[2].rotation.x = -.9), t.children[2].rotation.x > 0 && (t.children[2].rotation.x = -.13), t.children[2].position.z = 2 + t.children[0].position.z + (21 - 21 * (t.children[2].rotation.x + 1)), t.children[2].position.y = t.children[0].position.y + 6 - 12 * (t.children[2].rotation.x + 1), t.children[2].position.x = t.children[0].position.x - 1)) } calculate_life(t) { for (let e = 0; e < this.life_bar.children.length - 1; e++)e <= t - 1 ? this.life_bar.children[e].material = this.add_life_material : e > t - 1 && (this.life_bar.children[e].material = this.subtract_life_material) } create_plane(t) { let e = -1200; for (; e <= 1200;)if (t * Math.abs(e) % 17 == 2) { let i, o = e + 1200; i = o < 10 ? "000" + o : o < 100 ? "00" + o : o < 1e3 ? "0" + o : "" + o, this.plane_data.push({ id: t + "-" + i, positionx: e }), e += 19 } else e += e % 2 == 0 ? 1 : 2; this.previous_plane_key = this.plane_key } myLerp(t, e, i) { return t + (e - t) * i } myBezier(t, e, i, o) { return (1 - o) * (1 - o) * t + 2 * (1 - o) * o * e + o * o * i } render() { setInterval(() => { this.right_block = 0, this.left_block = 0; const t = this.clock.getElapsedTime(); this.previousTime; if (this.previousTime = t, this.timestamp > 1e4 && (this.timestamp = 0), this.plane_key !== this.receive_plane_key && (this.plane_key = this.receive_plane_key), -1 !== this.plane_key && this.plane_key !== this.previous_plane_key && (this.create_plane(this.plane_key), this.increase_planekeyTime = t), this.fox && (-1 === this.score_time && (this.score_time = t), t - this.score_time > 3 && this.die_sw), 1 === this.die_sw && (t - this.die_time > 1.5 && this.fox.position.y < -27 ? (this.scene.remove(this.fox), this.gg_board.classList.add("fadeOut2"), this.die_time = t) : (this.fox.position.y -= .35, this.Animate_Character(this.fox, 0, t, -1))), this.plane_data && this.ghost && this.moneysack && this.ham && this.chest) { for (let e = 0; e < this.plane_data.length; e++) { let i, o, s = Math.ceil(Math.abs(this.plane_data[e].id.substring(this.plane_data[e].id.length - 4, this.plane_data[e].id.length)) % 7); if (1 === s ? (i = this.trampoline.clone(), o = 1) : 2 === s ? (i = new THREE.Mesh(this.planegeometry, this.planematerial2), o = 2) : 3 === s ? (i = this.convey.clone(), o = 3) : 4 === s ? ((i = this.convey.clone()).rotation.z = Math.PI, o = 4) : 5 === s ? (i = this.sting_plane.clone(), o = 5) : (i = new THREE.Mesh(this.planegeometry, this.planematerial0), o = 0), i.position.y = -22.5, i.position.x = this.plane_data[e].positionx, this.scene.add(i), null === this.test_plane_size) { const t = (new THREE.Box3).setFromObject(i); this.test_plane_size = new THREE.Vector3, t.getSize(this.test_plane_size) } let a = (this.plane_key + 19 * e) % 29, n = null, l = -1; 1 === a || 14 === a || 25 === a ? (n = this.ham.clone(), this.scene.add(n), n.position.x = this.plane_data[e].positionx, l = 1) : 2 === a || 5 === a || 10 === a || 13 === a || 18 === a || 21 === a || 26 === a ? (n = this.ghost.clone(), this.scene.add(n), n.position.x = this.plane_data[e].positionx, l = 2) : 3 === a || 12 === a || 15 === a || 24 === a ? (n = this.moneysack.clone(), this.scene.add(n), n.position.x = this.plane_data[e].positionx, l = 3) : 4 === a && (n = this.chest.clone(), this.scene.add(n), n.position.x = this.plane_data[e].positionx, l = 4), this.objectsToUpdate.push({ id: this.plane_data[e].id, mesh: i, start_time: t, plane_type: o, object: n, object_type: l }) } this.plane_data = [] } if (this.worker && this.test_plane_size) { const e = [], i = [], o = this.test_plane_size.x; for (let t = 0; t < this.objectsToUpdate.length; t++)e.push({ positiony: this.objectsToUpdate[t].mesh.position.y, positionx: this.objectsToUpdate[t].mesh.position.x, id: this.objectsToUpdate[t].id, start_time: this.objectsToUpdate[t].start_time }); for (let t = 0; t < this.all_player_data.length; t++)i.push({ positiony: this.all_player_data[t].mesh.position.y, positionx: this.all_player_data[t].mesh.position.x, final_positiony: this.all_player_data[t].final_positiony, plane_id: this.all_player_data[t].plane_id }); let s = { type: "assign_plane", objectsToUpdate: e, all_player_data: i, elapsedTime: t, test_plane_size: o }; this.worker.postMessage(s) } for (let e = 0; e < this.objectsToUpdate.length; e++)if (this.objectsToUpdate[e].mesh.position.y += .2, 1 === this.objectsToUpdate[e].object_type ? this.objectsToUpdate[e].object.position.y = this.objectsToUpdate[e].mesh.position.y + 1.2 : 2 === this.objectsToUpdate[e].object_type ? (this.objectsToUpdate[e].object.position.y = this.objectsToUpdate[e].mesh.position.y + 3, this.objectsToUpdate[e].object.rotation.y = Math.cos(1 * (t - this.objectsToUpdate[e].start_time)), this.objectsToUpdate[e].object.position.x += Math.cos(1 * (t - this.objectsToUpdate[e].start_time)) / 15) : 3 === this.objectsToUpdate[e].object_type ? this.objectsToUpdate[e].object.position.y = this.objectsToUpdate[e].mesh.position.y + 1.5 : 4 === this.objectsToUpdate[e].object_type && (this.objectsToUpdate[e].object.position.y = this.objectsToUpdate[e].mesh.position.y + 1.2 + Math.abs(Math.sin(5 * (t - this.objectsToUpdate[e].start_time))) / 2), this.objectsToUpdate[e].mesh.position.y = Math.ceil(100 * this.objectsToUpdate[e].mesh.position.y) / 100, this.objectsToUpdate[e].mesh.position.y <= 21) { if (this.fox && 0 === this.die_sw && Math.abs(this.fox.position.y - this.objectsToUpdate[e].mesh.position.y - 1) < .4 && this.fox.position.x < this.objectsToUpdate[e].mesh.position.x + this.test_plane_size.x / 1.8 && this.fox.position.x > this.objectsToUpdate[e].mesh.position.x - this.test_plane_size.x / 1.8 && this.fox_plane !== this.objectsToUpdate[e].mesh && (this.fox_score++, this.own_score.innerHTML = this.fox_score, this.fox_onplane_time = t, this.fox_plane_id = this.objectsToUpdate[e].id, this.fox_plane_type = this.objectsToUpdate[e].plane_type, this.fox_plane = this.objectsToUpdate[e].mesh, this.objectsToUpdate[e].object && this.objectsToUpdate[e].object.position.x >= -2e3 ? (this.fox_object = this.objectsToUpdate[e].object, this.fox_object_type = this.objectsToUpdate[e].object_type) : (this.fox_object = null, this.fox_object_type = -1)), 3 === this.objectsToUpdate[e].plane_type) { this.objectsToUpdate[e].mesh.children[this.objectsToUpdate[e].mesh.children.length - 2].rotation.z = 2 * t, this.objectsToUpdate[e].mesh.children[this.objectsToUpdate[e].mesh.children.length - 3].rotation.z = 2 * t; for (let t = 0; t < this.objectsToUpdate[e].mesh.children.length - 4; t++)this.objectsToUpdate[e].mesh.children[t].position.y >= this.objectsToUpdate[e].mesh.children[this.objectsToUpdate[e].mesh.children.length - 1].position.y + .9 ? (this.objectsToUpdate[e].mesh.children[t].position.x -= .05, this.objectsToUpdate[e].mesh.children[t].position.x < this.objectsToUpdate[e].mesh.children[this.objectsToUpdate[e].mesh.children.length - 1].position.x - 5 && (this.objectsToUpdate[e].mesh.children[t].position.y -= 1.8)) : this.objectsToUpdate[e].mesh.children[t].position.y <= this.objectsToUpdate[e].mesh.children[this.objectsToUpdate[e].mesh.children.length - 1].position.y - .9 && (this.objectsToUpdate[e].mesh.children[t].position.x += .05, this.objectsToUpdate[e].mesh.children[t].position.x > this.objectsToUpdate[e].mesh.children[this.objectsToUpdate[e].mesh.children.length - 1].position.x + 5 && (this.objectsToUpdate[e].mesh.children[t].position.y += 1.8)) } if (4 === this.objectsToUpdate[e].plane_type) { this.objectsToUpdate[e].mesh.children[this.objectsToUpdate[e].mesh.children.length - 2].rotation.z = 2 * -t, this.objectsToUpdate[e].mesh.children[this.objectsToUpdate[e].mesh.children.length - 3].rotation.z = 2 * -t; for (let t = 0; t < this.objectsToUpdate[e].mesh.children.length - 4; t++)this.objectsToUpdate[e].mesh.children[t].position.y >= this.objectsToUpdate[e].mesh.children[this.objectsToUpdate[e].mesh.children.length - 1].position.y + .9 ? (this.objectsToUpdate[e].mesh.children[t].position.x += .05, this.objectsToUpdate[e].mesh.children[t].position.x > this.objectsToUpdate[e].mesh.children[this.objectsToUpdate[e].mesh.children.length - 1].position.x + 5 && (this.objectsToUpdate[e].mesh.children[t].position.y -= 1.8)) : this.objectsToUpdate[e].mesh.children[t].position.y <= this.objectsToUpdate[e].mesh.children[this.objectsToUpdate[e].mesh.children.length - 1].position.y - .9 && (this.objectsToUpdate[e].mesh.children[t].position.x -= .05, this.objectsToUpdate[e].mesh.children[t].position.x < this.objectsToUpdate[e].mesh.children[this.objectsToUpdate[e].mesh.children.length - 1].position.x - 5 && (this.objectsToUpdate[e].mesh.children[t].position.y += 1.8)) } 0 !== this.objectsToUpdate[e].mesh.rotation.x && (this.objectsToUpdate[e].mesh.rotation.x < 2 * Math.PI && (this.objectsToUpdate[e].mesh.rotation.x += Math.PI / 10), this.objectsToUpdate[e].mesh.rotation.x >= 2 * Math.PI && (this.objectsToUpdate[e].mesh.rotation.x = 0)) } else this.objectsToUpdate[e].mesh.position.y > 23 && (this.scene.remove(this.objectsToUpdate[e].mesh), this.scene.remove(this.objectsToUpdate[e].object), this.objectsToUpdate.splice(e, 1)); if (this.ready_for_load_model) { this.worker.onmessage = (e => { if ("assign_plane" === e.data.type) for (let i = 0; i < e.data.data.length; i++)null !== this.all_player_data[e.data.data[i].player].onplane ? this.objectsToUpdate[e.data.data[i].plane].mesh.position.y <= this.all_player_data[e.data.data[i].player].onplane.position.y && (this.all_player_data[e.data.data[i].player].onplane !== this.objectsToUpdate[e.data.data[i].plane].mesh && (this.all_player_data[e.data.data[i].player].onplane_time = t), this.all_player_data[e.data.data[i].player].onplane = this.objectsToUpdate[e.data.data[i].plane].mesh, this.all_player_data[e.data.data[i].player].plane_type = this.objectsToUpdate[e.data.data[i].plane].plane_type, this.all_player_data[e.data.data[i].player].object = this.objectsToUpdate[e.data.data[i].plane].object) : (this.all_player_data[e.data.data[i].player].onplane_time = t, this.all_player_data[e.data.data[i].player].onplane = this.objectsToUpdate[e.data.data[i].plane].mesh, this.all_player_data[e.data.data[i].player].plane_type = this.objectsToUpdate[e.data.data[i].plane].plane_type, this.all_player_data[e.data.data[i].player].object = this.objectsToUpdate[e.data.data[i].plane].object) }); for (let e = 0; e < this.all_player_data.length; e++) { if (1 === this.all_player_data[e].die_sw) { this.all_player_data[e].mesh.position.y -= .35, this.Animate_Character(this.all_player_data[e].mesh, 0, t, -1); let i = this.toXYCoords(this.all_player_data[e].mesh); this.all_player_data[e].name_mesh.style.transform = `translateX(${i.x}px) translateY(${i.y}px)`, this.all_player_data[e].name_mesh.style.top = window.innerHeight / 2 + "px", this.all_player_data[e].name_mesh.style.left = window.innerWidth / 2 + "px" } else { if (this.all_player_data[e].onplane && this.all_player_data[e].onplane.position.y > 21 && (this.all_player_data[e].onplane = null, this.all_player_data[e].plane_type = -1, this.all_player_data[e].object = null), this.all_player_data[e].mesh.position.x > this.camera.position.x - this.screenWidth && this.all_player_data[e].mesh.position.x < this.camera.position.x + this.screenWidth) { if (3 !== this.all_player_data[e].plane_type && 4 !== this.all_player_data[e].plane_type) { let t = Math.abs(this.all_player_data[e].final_positionx - this.all_player_data[e].mesh.position.x); t >= 2.5 ? this.all_player_data[e].mesh.position.x = this.myLerp(this.all_player_data[e].mesh.position.x, this.all_player_data[e].final_positionx, .25 / t) : t >= .25 ? this.all_player_data[e].final_positionx > this.all_player_data[e].mesh.position.x ? this.all_player_data[e].mesh.position.x += .25 : this.all_player_data[e].mesh.position.x -= .25 : t < .25 && (this.all_player_data[e].mesh.position.x = this.all_player_data[e].final_positionx) } else if (this.all_player_data[e].onplane && 3 === this.all_player_data[e].plane_type) { let t = Math.abs(this.all_player_data[e].final_positionx - this.all_player_data[e].mesh.position.x); t >= .1 ? this.all_player_data[e].final_positionx - this.all_player_data[e].mesh.position.x >= .1 ? this.all_player_data[e].mesh.position.x = this.myLerp(this.all_player_data[e].mesh.position.x, this.all_player_data[e].final_positionx, .1 / t) : this.all_player_data[e].mesh.position.x - this.all_player_data[e].final_positionx >= .8 ? this.all_player_data[e].mesh.position.x = this.myLerp(this.all_player_data[e].mesh.position.x, this.all_player_data[e].final_positionx, .4 / t) : this.all_player_data[e].mesh.position.x - this.all_player_data[e].final_positionx >= .15 && (this.all_player_data[e].mesh.position.x = this.myLerp(this.all_player_data[e].mesh.position.x, this.all_player_data[e].final_positionx, .15 / t)) : 1 == this.all_player_data[e].animation ? this.all_player_data[e].mesh.position.x -= .4 : 2 == this.all_player_data[e].animation ? this.all_player_data[e].mesh.position.x += .1 : 0 == this.all_player_data[e].animation && (this.all_player_data[e].mesh.position.x -= .15) } else if (this.all_player_data[e].onplane && 4 === this.all_player_data[e].plane_type) { let t = Math.abs(this.all_player_data[e].final_positionx - this.all_player_data[e].mesh.position.x); t >= .1 ? this.all_player_data[e].mesh.position.x - this.all_player_data[e].final_positionx >= .1 ? this.all_player_data[e].mesh.position.x = this.myLerp(this.all_player_data[e].mesh.position.x, this.all_player_data[e].final_positionx, .1 / t) : this.all_player_data[e].final_positionx - this.all_player_data[e].mesh.position.x >= .8 ? this.all_player_data[e].mesh.position.x = this.myLerp(this.all_player_data[e].mesh.position.x, this.all_player_data[e].final_positionx, .4 / t) : this.all_player_data[e].final_positionx - this.all_player_data[e].mesh.position.x >= .15 && (this.all_player_data[e].mesh.position.x = this.myLerp(this.all_player_data[e].mesh.position.x, this.all_player_data[e].final_positionx, .15 / t)) : 1 == this.all_player_data[e].animation ? this.all_player_data[e].mesh.position.x -= .1 : 2 == this.all_player_data[e].animation ? this.all_player_data[e].mesh.position.x += .4 : 0 == this.all_player_data[e].animation && (this.all_player_data[e].mesh.position.x += .15) } if (null === this.all_player_data[e].onplane) { let t = Math.abs(this.all_player_data[e].mesh.position.y - this.all_player_data[e].final_positiony); t >= 3 ? this.all_player_data[e].mesh.position.y = this.myLerp(this.all_player_data[e].mesh.position.y, this.all_player_data[e].final_positiony, .2 / t) : this.all_player_data[e].mesh.position.y -= .2 } else if (this.all_player_data[e].onplane) if (this.all_player_data[e].mesh.position.x < this.all_player_data[e].onplane.position.x + this.test_plane_size.x / 1.8 && this.all_player_data[e].mesh.position.x > this.all_player_data[e].onplane.position.x - this.test_plane_size.x / 1.8 && this.all_player_data[e].onplane.position.y - this.all_player_data[e].final_positiony < 3) if (1 === this.all_player_data[e].plane_type) this.all_player_data[e].onplane.children[this.all_player_data[e].onplane.children.length - 1].position.y = .04 * Math.cos(Math.PI * (22 * (t - this.all_player_data[e].onplane_time))) * 1.5 - .8, this.all_player_data[e].onplane.children[this.all_player_data[e].onplane.children.length - 2].position.y = .8 + .1 * Math.cos(Math.PI * (22 * (t - this.all_player_data[e].onplane_time))) * 1.5, this.all_player_data[e].mesh.position.y = this.all_player_data[e].onplane.position.y + 2 * Math.sin(Math.PI * (2.8 * (t - this.all_player_data[e].onplane_time))), this.all_player_data[e].mesh.position.y += 3, this.all_player_data[e].object && Math.abs(this.all_player_data[e].object.position.x - this.all_player_data[e].mesh.position.x) <= 2 && (this.fox_object === this.all_player_data[e].object && (this.fox_object = null, this.fox_object_type = -1), this.all_player_data[e].object.position.x = -5e3, this.scene.remove(this.all_player_data[e].object), this.all_player_data[e].object = null); else if (2 === this.all_player_data[e].plane_type) { let t = Math.abs(this.all_player_data[e].mesh.position.y - this.all_player_data[e].final_positiony); t >= 3 ? this.all_player_data[e].mesh.position.y = this.myLerp(this.all_player_data[e].mesh.position.y, this.all_player_data[e].final_positiony, .2 / t) : this.all_player_data[e].mesh.position.y -= .2, this.all_player_data[e].mesh.position.y < this.all_player_data[e].onplane.position.y + 1 ? (0 === this.all_player_data[e].onplane.rotation.x && (this.all_player_data[e].onplane.rotation.x += Math.PI / 10), this.all_player_data[e].onplane = null, this.all_player_data[e].plane_type = -1, this.all_player_data[e].object = null) : this.all_player_data[e].object && Math.abs(this.all_player_data[e].object.position.x - this.all_player_data[e].mesh.position.x) <= 2 && (this.fox_object === this.all_player_data[e].object && (this.fox_object = null, this.fox_object_type = -1), this.all_player_data[e].object.position.x = -5e3, this.scene.remove(this.all_player_data[e].object), this.all_player_data[e].object = null) } else if (this.all_player_data[e].mesh.position.y > this.all_player_data[e].onplane.position.y + 1.4) { let t = Math.abs(this.all_player_data[e].mesh.position.y - this.all_player_data[e].final_positiony); t >= 3 ? this.all_player_data[e].mesh.position.y = this.myLerp(this.all_player_data[e].mesh.position.y, this.all_player_data[e].final_positiony, .2 / t) : this.all_player_data[e].mesh.position.y -= .2 } else this.all_player_data[e].mesh.position.y = this.all_player_data[e].onplane.position.y + 1, this.all_player_data[e].object && Math.abs(this.all_player_data[e].object.position.x - this.all_player_data[e].mesh.position.x) <= 2 && (this.fox_object === this.all_player_data[e].object && (this.fox_object = null, this.fox_object_type = -1), this.all_player_data[e].object.position.x = -5e3, this.scene.remove(this.all_player_data[e].object), this.all_player_data[e].object = null); else { let t = Math.abs(this.all_player_data[e].mesh.position.y - this.all_player_data[e].final_positiony); t >= 3 ? this.all_player_data[e].mesh.position.y = this.myLerp(this.all_player_data[e].mesh.position.y, this.all_player_data[e].final_positiony, .2 / t) : this.all_player_data[e].mesh.position.y -= .2, this.all_player_data[e].onplane = null, this.all_player_data[e].plane_type = -1, this.all_player_data[e].object = null } this.fox && this.all_player_data[e].mesh.position.distanceTo(this.fox.position) <= 3.7 && this.all_player_data[e].onplane && this.fox_plane && this.all_player_data[e].onplane === this.fox_plane && (this.all_player_data[e].final_positionx > this.fox_finalpositionx && this.all_player_data[e].mesh.position.x > this.fox.position.x ? (this.all_player_data[e].final_positionx += .25, this.all_player_data[e].mesh.position.x += .25, this.right_block = 1, this.fox.position.x -= .25, this.fox_finalpositionx -= .25) : this.all_player_data[e].final_positionx < this.fox_finalpositionx && this.all_player_data[e].mesh.position.x < this.fox.position.x && (this.all_player_data[e].final_positionx -= .25, this.all_player_data[e].mesh.position.x -= .25, this.left_block = 1, this.fox.position.x += .25, this.fox_finalpositionx += .25)), this.Animate_Character(this.all_player_data[e].mesh, this.all_player_data[e].animation, t, this.all_player_data[e].emoji); let i = this.toXYCoords(this.all_player_data[e].mesh); this.all_player_data[e].name_mesh.style.transform = `translateX(${i.x}px) translateY(${i.y}px)`, this.all_player_data[e].name_mesh.style.top = window.innerHeight / 2 + "px", this.all_player_data[e].name_mesh.style.left = window.innerWidth / 2 + "px", 1 === this.all_player_data[e].rank ? (this.all_player_data[e].name_mesh.style.color = "gold", 0 === this.mobile ? this.all_player_data[e].name_mesh.innerHTML = '<font size="6vmin">👑</font>' + this.all_player_data[e].name : this.all_player_data[e].name_mesh.innerHTML = '<font size="3vmin">👑</font>' + this.all_player_data[e].name) : this.all_player_data[e].rank <= 10 ? (this.all_player_data[e].name_mesh.style.color = "gold", this.all_player_data[e].name_mesh.innerHTML = this.all_player_data[e].name) : (this.all_player_data[e].name_mesh.style.color = "white", this.all_player_data[e].name_mesh.innerHTML = this.all_player_data[e].name) } else this.all_player_data[e].mesh.position.x = this.all_player_data[e].final_positionx, this.all_player_data[e].mesh.position.y = this.all_player_data[e].final_positiony, this.all_player_data[e].name_mesh.style.transform = "translateX(10000px) translateY(10000px)"; new THREE.Vector3(this.all_player_data[e].final_positionx, this.all_player_data[e].final_positiony, 0).distanceTo(this.all_player_data[e].mesh.position) > 10 && (this.all_player_data[e].mesh.position.y = this.all_player_data[e].final_positiony, this.all_player_data[e].mesh.position.x = this.all_player_data[e].final_positionx, this.all_player_data[e].onplane = null, this.all_player_data[e].plane_type = -1, this.all_player_data[e].object = null) } this.all_player_data[e].mesh.position.y = Math.ceil(100 * this.all_player_data[e].mesh.position.y) / 100, this.all_player_data[e].mesh.position.x = Math.ceil(100 * this.all_player_data[e].mesh.position.x) / 100 } } if (this.fox && 0 === this.die_sw) { if (t - this.last_stabbed_time > .05 ? this.stabbed_plane.visible = !1 : this.stabbed_plane.visible = !0, t - this.last_ghost_time >= 5 ? document.querySelector(".ghost-modal").classList.add("hidden") : document.querySelector(".ghost-modal").classList.remove("hidden"), this.fox_status && this.fox_status.style.opacity > 0 && (this.fox_status.style.opacity -= .01), this.camera.position.x = this.fox.position.x, this.emoji_button_sw ? t - this.emoji_time > 3 && -1 !== this.emoji_sw ? (this.emoji_time = t, this.emoji = this.emoji_sw) : this.emoji_sw = -1 : t - this.emoji_time > 3 && (this.emoji = -1), this.left_sw ? (this.fox_animation = 1, 0 === this.left_block && (this.fox.position.x -= .25), this.Animate_Character(this.fox, 1, t, this.emoji)) : this.right_sw ? (this.fox_animation = 2, 0 === this.right_block && (this.fox.position.x += .25), this.Animate_Character(this.fox, 2, t, this.emoji)) : this.fox_plane || this.left_sw || this.right_sw || (this.fox_animation = 3, this.Animate_Character(this.fox, 3, t, this.emoji)), this.fox_plane && (this.fox.position.x < this.fox_plane.position.x - this.test_plane_size.x / 1.8 || this.fox.position.x > this.fox_plane.position.x + this.test_plane_size.x / 1.8) && (this.fox_plane = null, this.fox_plane_id = null, this.fox_object = null, this.fox_object_type = -1, this.left_sw || this.right_sw || (this.fox_animation = 3, this.Animate_Character(this.fox, 3, t, this.emoji))), this.fox_plane) { if (1 === this.fox_plane_type ? (this.fox.position.y - this.fox_plane.position.y - 1 < .4 && 0 === this.spring_sound_play ? (this.spring_sound_play = 1, this.fox_onplane_time !== t && this.fox_score++, this.own_score.innerHTML = this.fox_score) : this.fox.position.y - this.fox_plane.position.y - 1 >= .4 && 1 === this.spring_sound_play && (this.spring_sound_play = 0), 1 === this.spring_sound_play && this.spring_audio.play(), this.fox_plane.children[this.fox_plane.children.length - 1].position.y = .04 * Math.cos(Math.PI * (22 * (t - this.fox_onplane_time))) * 1.5 - .8, this.fox_plane.children[this.fox_plane.children.length - 2].position.y = .8 + .1 * Math.cos(Math.PI * (22 * (t - this.fox_onplane_time))) * 1.5, this.fox.position.y = this.fox_plane.position.y + 2 * Math.sin(Math.PI * (2.8 * (t - this.fox_onplane_time))), this.fox.position.y += 3, this.left_sw || this.right_sw || (this.fox_animation = 3, this.Animate_Character(this.fox, 3, t, this.emoji))) : 2 === this.fox_plane_type ? t - this.fox_onplane_time > .1 ? (this.fox.position.y -= .2, this.fox_plane.rotation.x += Math.PI / 10, this.fox_plane = null, this.fox_object = null, this.fox_object_type = -1, this.left_sw || this.right_sw || (this.fox_animation = 3, this.Animate_Character(this.fox, 3, t, this.emoji))) : (this.fox_previousPlane = this.fox_plane, this.fox.position.y = this.fox_plane.position.y + 1, this.left_sw || this.right_sw || (this.fox_animation = 0, this.Animate_Character(this.fox, 0, t, this.emoji))) : (this.fox.position.y = this.fox_plane.position.y + 1, this.left_sw || this.right_sw || (this.fox_animation = 0, this.Animate_Character(this.fox, 0, t, this.emoji))), 0 === this.fox_plane_type && this.fox_previousPlane !== this.fox_plane && this.plane_audio.play(), 2 === this.fox_plane_type && this.fox_previousPlane !== this.fox_plane && this.fake_audio.play(), 3 === this.fox_plane_type && (this.fox.position.x -= .15, this.fox_previousPlane !== this.fox_plane && this.convey_audio.play()), 4 === this.fox_plane_type && (this.fox.position.x += .15, this.fox_previousPlane !== this.fox_plane && this.convey_audio.play()), 5 === this.fox_plane_type && this.fox_life > 0 && this.fox_previousPlane !== this.fox_plane && (this.fox_life -= 3, this.stabbed_audio.play(), this.last_stabbed_time = t), -1 !== this.fox_object_type && Math.abs(this.fox.position.x - this.fox_object.position.x) <= 2) { if (2 === this.fox_object_type) this.last_ghost_time = t, this.devil_audio.play(); else if (1 === this.fox_object_type) this.fox_life < 10 && (this.fox_life += 1), this.bite_audio.play(), this.fox_status.style.color = "rgb(68, 236, 35)", 0 === this.mobile ? this.fox_status.innerHTML = '<font size="5vmin">+1hp</font>' : this.fox_status.innerHTML = '<font size="2vmin">+1hp</font>', this.fox_status.style.opacity = 1; else if (3 === this.fox_object_type) this.sack_audio.play(), this.fox_score += 5, this.own_score.innerHTML = this.fox_score, this.fox_status.style.color = "white", 0 === this.mobile ? this.fox_status.innerHTML = '<font size="5vmin">+5</font>' : this.fox_status.innerHTML = '<font size="2vmin">+5</font>', this.fox_status.style.opacity = 1; else if (4 === this.fox_object_type) { this.chest_audio.play(); let t = 5 * Math.ceil(20 * Math.random()); this.fox_score += t, this.own_score.innerHTML = this.fox_score, this.fox_status.style.color = "white", 0 === this.mobile ? this.fox_status.innerHTML = '<font size="5vmin">+' + t + "</font>" : this.fox_status.innerHTML = '<font size="2vmin">+' + t + "</font>", this.fox_status.style.opacity = 1 } this.scene.remove(this.fox_object), this.fox_object_type = -1, this.fox_object = null } } else this.fox.position.y -= .2; this.fox_plane && this.fox_plane.position.y > 21 && (this.stabbed_audio.play(), this.fox_plane = null, this.fox_object = null, this.fox_object_type = -1, this.fox_life > 0 && (this.fox_life -= 3), this.last_stabbed_time = t), this.fox.position.y < -23 && 0 === this.die_sw && (this.die_audio.play(), this.die_sw = 1, this.fox_name.remove(), this.fox_status.remove(), document.querySelector(".final_score").innerHTML += this.fox_score, this.die_time = t), this.fox_life <= 0 && 0 === this.die_sw && (this.die_audio.play(), this.die_sw = 1, this.fox_name.remove(), this.fox_status.remove(), document.querySelector(".final_score").innerHTML += this.fox_score, this.die_time = t), this.fox.position.y = Math.ceil(100 * this.fox.position.y) / 100, this.fox.position.x = Math.ceil(100 * this.fox.position.x) / 100, document.querySelector(".current-position").innerHTML = "Position: " + this.fox.position.x, this.calculate_life(this.fox_life); let e = { title: "10", data: [this.myID, this.fox.position.x, this.fox.position.y, this.fox_plane_id, this.fox_animation, this.fox_score, this.emoji, this.timestamp, this.die_sw, this.fox_rank] }; this.socket.send(JSON.stringify(e)), this.timestamp++; let i = this.toXYCoords(this.fox); this.fox_name.style.transform = `translateX(${i.x}px) translateY(${i.y}px)`, this.fox_name.style.top = window.innerHeight / 2 + "px", this.fox_name.style.left = window.innerWidth / 2 + "px", this.fox_status.style.transform = `translateX(${i.x}px) translateY(${i.y}px)`, this.fox_status.style.top = window.innerHeight / 2 + "px", this.fox_status.style.left = window.innerWidth / 2 + "px", 1 === this.fox_rank ? (this.fox_name.style.color = "gold", 0 === this.mobile ? this.fox_name.innerHTML = '<font size="6vmin">👑</font>' + document.querySelector(".Name").value : this.fox_name.innerHTML = '<font size="3vmin">👑</font>' + document.querySelector(".Name").value) : this.fox_rank <= 10 ? (this.fox_name.style.color = "gold", this.fox_name.innerHTML = document.querySelector(".Name").value) : (this.fox_name.style.color = "white", this.fox_name.innerHTML = document.querySelector(".Name").value) } null !== this.fox_plane && (this.fox_previousPlane = this.fox_plane), this.screenWidth && this.life_bar && this.life_bar.position.set(this.camera.position.x - this.screenWidth / 2 * .75, 18, 10), this.stabbed_plane.position.set(this.camera.position.x, 0, 10), this.renderer.render(this.scene, this.camera) }, 1e3 / 60) } } export { App };